<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ­£åœ¨ä¸ºä½ è·³è½¬ B ç«™è§†é¢‘...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f6f6f6; }
        .card { width: 80%; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); text-align: center; }
        .bili-pink { color: #fb7299; font-weight: bold; }
        .shake-icon { font-size: 64px; margin: 20px 0; animation: shake 0.5s infinite alternate; }
        @keyframes shake { from { transform: rotate(-10deg); } to { transform: rotate(10deg); } }
        .btn { background: #fb7299; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 20px; }
        #wechat-guide { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; text-align: right; padding: 20px; box-sizing: border-box; z-index: 100; }
    </style>
</head>
<body>

    <div id="wechat-guide">ç‚¹å‡»å³ä¸Šè§’é€‰æ‹©â€œåœ¨æµè§ˆå™¨æ‰“å¼€â€ â†—ï¸</div>

    <div class="card">
        <div class="shake-icon">ğŸ“±</div>
        <p>ç›‘å¬åˆ°å¥½å‹åˆ†äº«çš„è§†é¢‘</p>
        <p class="bili-pink">ã€Œæ‘‡ä¸€æ‘‡ã€æˆ–ç‚¹å‡»æŒ‰é’®ç›´æ¥è¿›å…¥ B ç«™</p>
        <button class="btn" id="activeBtn">ç«‹å³è§‚çœ‹</button>
    </div>

    <script>
        // 1. é…ç½®è·³è½¬å‚æ•°
        const BV_ID = "BV1dm4y1p7bZ"; // åœ¨è¿™é‡Œæ›¿æ¢ä½ æƒ³åˆ†äº«çš„è§†é¢‘å·
        const BILI_SCHEME = `bilibili://video/${BV_ID}`;
        const BILI_UNIVERSAL_LINK = `https://www.bilibili.com/video/${BV_ID}`;

        const activeBtn = document.getElementById('activeBtn');
        const wechatGuide = document.getElementById('wechat-guide');

        // 2. æ£€æµ‹ç¯å¢ƒ
        const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
        if (isWeChat) {
            wechatGuide.style.display = 'block'; // å¾®ä¿¡å†…å¼•å¯¼å¤–éƒ¨æ‰“å¼€
        }

        // 3. æ ¸å¿ƒè·³è½¬å‡½æ•°
        function doJump() {
            window.location.href = BILI_SCHEME;
            // å¦‚æœ3ç§’å†…æ²¡è·³è½¬ï¼ˆæ²¡è£…Appï¼‰ï¼Œåˆ™å»ç½‘é¡µç‰ˆ
            setTimeout(() => {
                window.location.href = BILI_UNIVERSAL_LINK;
            }, 3000);
        }

        // 4. ä¼ æ„Ÿå™¨ä¼˜åŒ–é€»è¾‘
        let lastTime = 0;
        let lastX, lastY, lastZ;
        const SHAKE_THRESHOLD = 800; // çµæ•åº¦ï¼ˆå€¼è¶Šå°è¶Šçµæ•ï¼‰

        function onDeviceMotion(event) {
            const acceleration = event.accelerationIncludingGravity;
            const curTime = Date.now();
            
            if ((curTime - lastTime) > 100) {
                const diffTime = curTime - lastTime;
                lastTime = curTime;

                const x = acceleration.x;
                const y = acceleration.y;
                const z = acceleration.z;

                const speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;

                if (speed > SHAKE_THRESHOLD) {
                    doJump();
                }
                lastX = x; lastY = y; lastZ = z;
            }
        }

        // 5. æƒé™å¤„ç†ï¼ˆiOS 13+ å¿…é¡»ç‚¹å‡»åæ‰èƒ½å¼€å¯ä¼ æ„Ÿå™¨ï¼‰
        activeBtn.addEventListener('click', () => {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('devicemotion', onDeviceMotion);
                            doJump(); // ç‚¹å‡»ä¹Ÿç›´æ¥è·³ä¸€æ¬¡
                        }
                    })
                    .catch(console.error);
            } else {
                // éiOSç³»ç»Ÿ
                window.addEventListener('devicemotion', onDeviceMotion);
                doJump();
            }
        });
    </script>
</body>
</html>
